<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhySiCaS - Physics Simulations and Calculations Software</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCrgyxFzkkfwfmnA7hddU1xef2h5TV2cPw",
            authDomain: "physicas-dashboard.firebaseapp.com",
            projectId: "physicas-dashboard",
            storageBucket: "physicas-dashboard.firebasestorage.app",
            messagingSenderId: "407330988182",
            appId: "1:407330988182:web:86e1a45ab7e79efbe922b7",
            measurementId: "G-9R38NSH8NH"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Make Firebase functions globally available
        window.db = db;
        window.auth = auth;
        window.firebaseModules = {
            collection,
            addDoc,
            getDocs,
            query,
            orderBy,
            signInWithEmailAndPassword,
            signOut,
            onAuthStateChanged
        };
    </script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- New Animated Background Elements -->
    <!-- Floating Science Icons -->
    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0;">
        <!-- Rockets -->
        <div class="float-sci-1" style="position: absolute; top: 10%; left: 10%; font-size: 50px; opacity: 0.3;">üöÄ</div>
        <div class="float-sci-2" style="position: absolute; top: 60%; right: 20%; font-size: 40px; opacity: 0.25;">üöÄ</div>
        
        <!-- Test Tubes -->
        <div class="float-sci-3" style="position: absolute; top: 40%; left: 25%; font-size: 55px; opacity: 0.35;">üß™</div>
        <div class="float-sci-4" style="position: absolute; bottom: 40%; right: 30%; font-size: 45px; opacity: 0.3;">üß™</div>
        
        <!-- Atoms -->
        <div class="float-sci-5" style="position: absolute; top: 80%; right: 10%; font-size: 50px; opacity: 0.4;">‚öõÔ∏è</div>
        <div class="float-sci-6" style="position: absolute; bottom: 60%; left: 20%; font-size: 60px; opacity: 0.25;">‚öõÔ∏è</div>
        
        <!-- Microscopes -->
        <div class="float-sci-1" style="position: absolute; top: 30%; right: 25%; font-size: 50px; opacity: 0.3;">üî¨</div>
        <div class="float-sci-2" style="position: absolute; bottom: 20%; left: 30%; font-size: 45px; opacity: 0.35;">üî¨</div>
        
        <!-- Magnifying Glass -->
        <div class="float-sci-3" style="position: absolute; top: 50%; left: 10%; font-size: 55px; opacity: 0.25;">üîç</div>
        <div class="float-sci-4" style="position: absolute; top: 20%; right: 30%; font-size: 50px; opacity: 0.4;">üîç</div>
        
        <!-- Beakers -->
        <div class="float-sci-5" style="position: absolute; bottom: 30%; right: 20%; font-size: 45px; opacity: 0.3;">‚öóÔ∏è</div>
        <div class="float-sci-6" style="position: absolute; top: 70%; left: 25%; font-size: 50px; opacity: 0.35;">‚öóÔ∏è</div>
    </div>
    
    <!-- Cartoon Scientists in Bubbles -->
    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0;">
        <!-- Scientist 1 -->
        <div class="bubble-sci-1" style="position: absolute; top: 15%; left: 30%;">
            <div style="width: 80px; height: 80px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); border: 2px solid rgba(255, 255, 255, 0.3);">
                <span style="font-size: 35px;">üë®‚Äçüî¨</span>
            </div>
        </div>
        
        <!-- Scientist 2 -->
        <div class="bubble-sci-2" style="position: absolute; top: 50%; right: 25%;">
            <div style="width: 90px; height: 90px; background: rgba(221, 160, 221, 0.25); border-radius: 50%; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); border: 2px solid rgba(221, 160, 221, 0.4);">
                <span style="font-size: 40px;">üë©‚Äçüî¨</span>
            </div>
        </div>
        
        <!-- Scientist 3 -->
        <div class="bubble-sci-3" style="position: absolute; bottom: 30%; left: 25%;">
            <div style="width: 70px; height: 70px; background: rgba(173, 216, 230, 0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); border: 2px solid rgba(173, 216, 230, 0.35);">
                <span style="font-size: 30px;">üßë‚Äçüî¨</span>
            </div>
        </div>
        
        <!-- Scientist 4 -->
        <div class="bubble-sci-4" style="position: absolute; top: 65%; right: 30%;">
            <div style="width: 85px; height: 85px; background: rgba(152, 251, 152, 0.25); border-radius: 50%; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); border: 2px solid rgba(152, 251, 152, 0.4);">
                <span style="font-size: 35px;">üë®‚Äçüî¨</span>
            </div>
        </div>
    </div>
    
    <!-- Animated Abstract Lines -->
    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0;">
        <!-- Horizontal Lines -->
        <div class="drift-sci-1" style="position: absolute; top: 25%; width: 200px; height: 4px; background: linear-gradient(90deg, transparent, rgba(173, 216, 230, 0.6), transparent); border-radius: 10px; filter: blur(0.3px);"></div>
        <div class="drift-sci-2" style="position: absolute; top: 50%; width: 150px; height: 4px; background: linear-gradient(90deg, transparent, rgba(221, 160, 221, 0.6), transparent); border-radius: 10px; filter: blur(0.3px);"></div>
        <div class="drift-sci-3" style="position: absolute; top: 75%; width: 180px; height: 4px; background: linear-gradient(90deg, transparent, rgba(152, 251, 152, 0.6), transparent); border-radius: 10px; filter: blur(0.3px);"></div>
        <div class="drift-sci-4" style="position: absolute; top: 35%; width: 120px; height: 4px; background: linear-gradient(90deg, transparent, rgba(255, 192, 203, 0.6), transparent); border-radius: 10px; filter: blur(0.3px);"></div>
        <div class="drift-sci-5" style="position: absolute; top: 65%; width: 160px; height: 4px; background: linear-gradient(90deg, transparent, rgba(255, 228, 181, 0.6), transparent); border-radius: 10px; filter: blur(0.3px);"></div>
    </div>
    
    <!-- Soft Pastel Circles -->
    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0;">
        <!-- Sky Blue Circles -->
        <div class="pulse-sci-1" style="position: absolute; top: 10%; left: 15%; width: 120px; height: 120px; background: rgba(135, 206, 235, 0.2); border-radius: 50%; filter: blur(20px);"></div>
        <div class="pulse-sci-2" style="position: absolute; bottom: 20%; right: 20%; width: 180px; height: 180px; background: rgba(135, 206, 235, 0.15); border-radius: 50%; filter: blur(30px);"></div>
        
        <!-- Purple Circles -->
        <div class="pulse-sci-3" style="position: absolute; top: 50%; left: 30%; width: 150px; height: 150px; background: rgba(221, 160, 221, 0.25); border-radius: 50%; filter: blur(25px);"></div>
        <div class="pulse-sci-4" style="position: absolute; top: 25%; right: 15%; width: 100px; height: 100px; background: rgba(221, 160, 221, 0.3); border-radius: 50%; filter: blur(15px);"></div>
        
        <!-- Mint Circles -->
        <div class="pulse-sci-5" style="position: absolute; bottom: 30%; left: 10%; width: 140px; height: 140px; background: rgba(152, 251, 152, 0.2); border-radius: 50%; filter: blur(25px);"></div>
        <div class="pulse-sci-1" style="position: absolute; top: 70%; right: 25%; width: 110px; height: 110px; background: rgba(152, 251, 152, 0.25); border-radius: 50%; filter: blur(20px);"></div>
        
        <!-- Pink Circles -->
        <div class="pulse-sci-2" style="position: absolute; top: 40%; left: 50%; width: 170px; height: 170px; background: rgba(255, 192, 203, 0.15); border-radius: 50%; filter: blur(35px);"></div>
        <div class="pulse-sci-3" style="position: absolute; bottom: 15%; left: 25%; width: 80px; height: 80px; background: rgba(255, 192, 203, 0.35); border-radius: 50%; filter: blur(12px);"></div>
    </div>
    
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>PhySiCaS</h1>
            <p style="font-size: 14px;">Physics Simulations and Calculations Software</p>
            
            <!-- Navigation Tabs -->
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('simulations')">Simulations</button>
                <button class="nav-tab" onclick="showTab('feedback')">Feedback</button>
                <button class="nav-tab" onclick="showTab('contact')">About Us</button>
            </div>
        </div>

        <!-- Tab Contents -->
        <div class="tab-content active" id="simulations">
            <!-- Main Menu -->
            <div class="main-menu active" id="mainMenu">
                <div class="menu-grid">
                    <button class="menu-item" onclick="showSimulation('projectile')">
                        <h3>üöÄ Projectile Motion</h3>
                    </button>
                    <button class="menu-item" onclick="showSimulation('spring')">
                        <h3>üöÄ Mass-Spring System</h3>
                    </button>
                    <button class="menu-item" onclick="showSimulation('lens')">
                        <h3>ü™û Lens</h3>
                    </button>
                    <button class="menu-item" onclick="showSimulation('mirror')">
                        <h3>ü™û Curved Mirror</h3>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="contact">
            <div style="background: rgba(255, 255, 255, 0.95); border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); text-align: center;">
                <h2 style="color: #2c3e50; margin-bottom: 20px;">Contact</h2>
                <p style="color: #2c3e50; font-size: 1.2em; margin-bottom: 10px;">üìß Email:</p>
                <p style="color: #3498db; font-size: 1.3em; font-weight: 600; margin-bottom: 20px;">physicas.photon@gmail.com</p>
                <p style="color: #2c3e50; margin-bottom: 5px;">This website was created as a computer project by students of Suankularbwittayalai Rangsit School, Thailand</p>
            </div>
        </div>

        <div class="tab-content" id="update">
            <div style="background: rgba(255, 255, 255, 0.95); border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); text-align: center;">
                <h2 style="color: #2c3e50; margin-bottom: 20px;">Version 1.2.1</h2>
                <ul style="list-style: none; padding-left: 0; margin-left: 0; text-align: left;">
                    <li style="margin-bottom: 8px;">‚Ä¢ Add "Feedback tab", You can rate us and leave comments to us!</li>
                </ul>
            </div>
        </div>

        <div class="tab-content" id="feedback">
            <div class="content-panel">
                <div id="feedbackForm" style="max-width: 600px; margin: 0 auto;; text-align: center;">
                    <div style="margin-bottom: 30px;">
                        <h2 style="color: #2c3e50; margin-bottom: 20px;">Rate Your Experience</h2>
                        <div class="star-rating" style="display: flex; justify-content: center; gap: 10px; margin-bottom: 20px;">
                            <span class="star" data-rating="1" onclick="setRating(1)">‚òÖ</span>
                            <span class="star" data-rating="2" onclick="setRating(2)">‚òÖ</span>
                            <span class="star" data-rating="3" onclick="setRating(3)">‚òÖ</span>
                            <span class="star" data-rating="4" onclick="setRating(4)">‚òÖ</span>
                            <span class="star" data-rating="5" onclick="setRating(5)">‚òÖ</span>
                        </div>
                        <p id="ratingText" style="text-align: center; color: #666; font-style: italic;">Click on stars to rate</p>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="feedbackComment" style="display: block; margin-bottom: 10px; font-weight: 600; color: #2c3e50;">Your Feedback (optional):</label>
                        <textarea id="feedbackComment" rows="5" style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-family: inherit; font-size: 1em; resize: vertical;" placeholder="Tell us about your experience with PhySiCaS..."></textarea>
                    </div>
                    
                    <button id="submitFeedback" onclick="submitFeedback()" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 15px 30px; border-radius: 25px; font-family: inherit; font-size: 1.1em; font-weight: 600; cursor: pointer; width: 100%; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='0 4px 15px rgba(40, 167, 69, 0.3)'">
                        Submit Feedback
                    </button>
                </div>
                
                <div id="feedbackSuccess" style="display: none; text-align: center; max-width: 400px; margin: 0 auto;">
                    <div style="background: linear-gradient(135deg, #d4edda, #c3e6cb); padding: 30px; border-radius: 15px; border: 2px solid #28a745;">
                        <h3 style="color: #155724; margin-bottom: 15px;">üéâ Thank you!</h3>
                        <p style="color: #155724; font-size: 1.1em;">Your feedback has been submitted successfully. We appreciate your comment!</p>
                    </div>
                </div>
                
                <!-- Admin Login Button -->
                <div style="margin-top: 40px; text-align: center; border-top: 2px solid #ecf0f1; padding-top: 30px;">
                    <button id="adminLoginBtn" onclick="showAdminLogin()" style="background: linear-gradient(135deg, #6c757d, #495057); color: white; border: none; padding: 10px 20px; border-radius: 20px; font-family: inherit; font-size: 0.9em; cursor: pointer; transition: all 0.3s ease;">
                        üîê Log In (admin)
                    </button>
                </div>
                
                <!-- Admin Login Modal -->
                <div id="adminLoginModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; backdrop-filter: blur(5px);">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 400px; width: 90%;">
                        <h3 style="color: #2c3e50; margin-bottom: 20px; text-align: center;">Admin Login</h3>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Email:</label>
                            <input type="email" id="adminEmail" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-family: inherit;">
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Password:</label>
                            <input type="password" id="adminPassword" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-family: inherit;">
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="adminLogin()" style="flex: 1; background: linear-gradient(135deg, #0066ff, #004bb5); color: white; border: none; padding: 12px; border-radius: 8px; font-family: inherit; font-weight: 600; cursor: pointer;">Login</button>
                            <button onclick="closeAdminLogin()" style="flex: 1; background: linear-gradient(135deg, #6c757d, #495057); color: white; border: none; padding: 12px; border-radius: 8px; font-family: inherit; font-weight: 600; cursor: pointer;">Cancel</button>
                        </div>
                    </div>
                </div>
                
                <!-- Admin Dashboard -->
                <div id="adminDashboard" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #ecf0f1;">
                        <h2 style="color: #2c3e50; margin: 0;">üìä Admin Dashboard</h2>
                        <button onclick="adminLogout()" style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; border: none; padding: 10px 20px; border-radius: 20px; font-family: inherit; cursor: pointer;">Log Out</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); padding: 20px; border-radius: 15px; text-align: center;">
                            <h3 style="color: #1565c0; margin-bottom: 10px;">Total Feedback</h3>
                            <p id="totalFeedback" style="font-size: 2em; font-weight: bold; color: #0d47a1; margin: 0;">0</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #fff3e0, #ffcc02); padding: 20px; border-radius: 15px; text-align: center;">
                            <h3 style="color: #ef6c00; margin-bottom: 10px;">Average Rating</h3>
                            <p id="averageRating" style="font-size: 2em; font-weight: bold; color: #e65100; margin: 0;">0.0 ‚≠ê</p>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px;">
                        <h3 style="color: #2c3e50; margin-bottom: 20px;">Recent Feedback</h3>
                        <div id="feedbackList" style="max-height: 400px; overflow-y: auto;">
                            <p style="text-align: center; color: #666; font-style: italic;">No feedback yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Projectile Motion Simulation -->
        <div class="simulation-page" id="projectile">
            <div class="sim-header">
                <h2>Projectile Motion</h2>
                <button class="back-btn" onclick="showMainMenu()">‚Üê Back to Menu</button>
            </div>
            <div class="sim-content">
                <div class="left-panel">
                    <!-- Input Panel -->
                    <div class="panel">
                        <h3>Input Parameters</h3>
                        <div class="input-group">
                            <label>$v_0$ - Initial Velocity $(\mathrm{m{\cdot}s^{-1}})$:</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="v0" value="2" step="0.1" style="flex: 1;">
                                <span style="font-weight: bold;">√ó10^</span>
                                <input type="number" id="v0_exp" value="1" step="1" style="width: 60px;" title="Power of 10">
                            </div>
                        </div>
                        <div class="input-group">
                            <label>$\theta$ - Launch Angle $(\mathrm{^\circ})$:</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="projectile_angle" value="4.5" step="0.1">
                                <span style="font-weight: bold;">√ó10^</span>
                                <input type="number" id="projectile_angle_exp" value="1" step="1" style="width: 60px;" title="Power of 10">
                            </div>
                            
                        </div>
                        <div class="input-group">
                            <label>$g$ - Gravitational Acceleration $(\mathrm{m{\cdot}s^{-2}})$:</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="g" value="9.80665" step="0.001" style="flex: 1;">
                                <span style="font-weight: bold;">√ó10^</span>
                                <input type="number" id="g_exp" value="0" step="1" style="width: 60px;" title="Power of 10">
                            </div>
                        </div>
                        <div class="input-group">
                            <label>$\beta$ - Air Resistance Coefficient:</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="beta" value="0" step="0.001" min="0" style="flex: 1;">
                                <span style="font-weight: bold;">√ó10^</span>
                                <input type="number" id="beta_exp" value="0" step="1" style="width: 60px;" title="Power of 10">
                            </div>
                        </div>
                        <div class="input-group">
                            <label>$m$ - Mass $(\mathrm{kg})$:</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="mass" value="1" step="0.1" min="0.1" style="flex: 1;">
                                <span style="font-weight: bold;">√ó10^</span>
                                <input type="number" id="mass_exp" value="0" step="1" style="width: 60px;" title="Power of 10">
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Time Speed Multiplier:</label>
                            <input type="number" id="timeSpeed" value="1" step="0.1" min="0.1" max="5">
                        </div>
                        <button class="calculate-btn" onclick="calculateProjectile()">Calculate</button>
                    </div>

                    <!-- Output Panel -->
                    <div class="panel">
                        <h3>Results</h3>
                        <div id="projectileResults">
                            <div class="output-item">Click "Calculate" to see results</div>
                        </div>
                    </div>
                </div>

                <div class="right-panel">
                    <!-- Simulation Panel -->
                    <div class="panel">
                        <h3>Simulation</h3>
                        <div class="canvas-container">
                            <canvas id="projectileCanvas" width="400" height="300"></canvas>
                            <div style="margin-top: 10px;">
                                <button class="calculate-btn" onclick="animateProjectile()" style="width: auto; padding: 8px 16px; margin: 5px;">‚ñ∂Ô∏è Start</button>
                                <button onclick="stopAnimation()" style="background: #e74c3c; color: white; border: none; padding: 8px 16px; margin: 5px; border-radius: 5px; cursor: pointer;">‚èπÔ∏è Stop</button>
                                <button id="projectilePauseBtn" onclick="toggleProjectilePause()" style="background: #f39c12; color: white; border: none; padding: 8px 16px; margin: 5px; border-radius: 5px; cursor: pointer;">‚è∏Ô∏è Pause</button>
                                <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px; border: 2px solid #3498db;">
                                    <strong style="font-size: 16px; color: #2c3e50;">Time: <span id="projectileTime" style="color: #e74c3c; font-size: 18px;">0.00</span> s</strong>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Graphs Panel -->
                    <div class="panel">
                        <h3>Position vs Time Graphs</h3>
                        <div class="canvas-container">
                            <canvas id="projectileGraphs" width="500" height="350"></canvas>
                        </div>
                    </div>

                    <!-- Theory Panel -->
                    <div class="panel">
                        <h3>Theory & Formulas</h3>
                        <div class="theory-content">
                            <div class="formula-box">
                                <strong>Air Resistance Force Formula:</strong><br>
                                $\vec{F}_\mathrm{drag} = -\beta\vec{v}$<br>
                                where $\beta$ is the air resistance coefficient
                            </div>
                            <div class="formula-box">
                                <strong>Key Results (without air resistance):</strong><br>
                                Range: $R = \dfrac{v_0^2 \sin(2\theta)}{g}$<br>
                                Maximum height: $H = \dfrac{v_0^2 \sin^2(\theta)}{2g}$<br>
                                Flight time: $\tau = \dfrac{2v_0 \sin(\theta)}{g}$
                            </div>
                        </div>
                        
                        <!-- PDF Link Section -->
                        <div style="margin-top: 20px; padding-top: 15px; border-top: 2px solid #ecf0f1;">
                            <h4 style="color: #2c3e50; margin-bottom: 10px;">üìö Advanced Theory</h4>
                            <a href="https://drive.google.com/file/d/1YZTghaV22dYRK6i3zdzSzPsIE8FOVb1-/view?usp=sharing" target="_blank" class="calculate-btn" style="background: #8e44ad; margin-bottom: 5px; text-decoration: none; display: inline-block; text-align: center;">
                                üìÑ Projectile Motion Theory (PDF)
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mass-Spring System Simulation -->
        <div class="simulation-page" id="spring">
            <div class="sim-header">
                <h2>Mass-Spring System</h2>
                <button class="back-btn" onclick="showMainMenu()">‚Üê Back to Menu</button>
            </div>
            <div class="sim-content">
                <div class="left-panel">
                    <div class="panel">
                        <h3>Input Parameters</h3>
                        <div class="input-group">
                            <label>$m$ - Mass $(\mathrm{kg})$:</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="springMass" value="1" step="0.1" min="0.1" style="flex: 1;">
                                <span style="font-weight: bold;">√ó10^</span>
                                <input type="number" id="springMass_exp" value="0" step="1" style="width: 60px;" title="Power of 10">
                            </div>
                        </div>
                        <div class="input-group">
                            <label>$k$ - Spring Constant $(\mathrm{kg{\cdot}s^{-2}})$:</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="springK" value="1" step="0.1" min="0.1" style="flex: 1;">
                                <span style="font-weight: bold;">√ó10^</span>
                                <input type="number" id="springK_exp" value="0" step="1" style="width: 60px;" title="Power of 10">
                            </div>
                        </div>
                        <div class="input-group">
                            <label>$x_0$ - Initial Position $(\mathrm{m})$:</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="springX0" value="1" step="0.01" style="flex: 1;">
                                <span style="font-weight: bold;">√ó10^</span>
                                <input type="number" id="springX0_exp" value="0" step="1" style="width: 60px;" title="Power of 10">
                            </div>
                        </div>
                        <div class="input-group">
                            <label>$v_0$ - Initial Velocity $(\mathrm{m{\cdot}s^{-1}})$:</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="springV0" value="0" step="0.1" style="flex: 1;">
                                <span style="font-weight: bold;">√ó10^</span>
                                <input type="number" id="springV0_exp" value="0" step="1" style="width: 60px;" title="Power of 10">
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Time Speed Multiplier:</label>
                            <input type="number" id="springTimeSpeed" value="1" step="0.1" min="0.1" max="5">
                        </div>
                        <button class="calculate-btn" onclick="calculateSpring()">Calculate</button>
                    </div>

                    <div class="panel">
                        <h3>Results</h3>
                        <div id="springResults">
                            <div class="output-item">Click "Calculate" to see results</div>
                        </div>
                    </div>
                </div>

                <div class="right-panel">
                    <div class="panel">
                        <h3>Simulation</h3>
                        <div class="canvas-container">
                            <canvas id="springCanvas" width="400" height="300"></canvas>
                            <div style="margin-top: 10px;">
                                <button class="calculate-btn" onclick="animateSpring()" style="width: auto; padding: 8px 16px; margin: 5px;">‚ñ∂Ô∏è Start</button>
                                <button onclick="stopSpringAnimation()" style="background: #e74c3c; color: white; border: none; padding: 8px 16px; margin: 5px; border-radius: 5px; cursor: pointer;">‚èπÔ∏è Stop</button>
                                <button id="springPauseBtn" onclick="toggleSpringPause()" style="background: #f39c12; color: white; border: none; padding: 8px 16px; margin: 5px; border-radius: 5px; cursor: pointer;">‚è∏Ô∏è Pause</button>
                                <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px; border: 2px solid #3498db;">
                                    <strong style="font-size: 16px; color: #2c3e50;">Time: <span id="springTime" style="color: #e74c3c; font-size: 18px;">0.00</span> s</strong>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Graphs Panel -->
                    <div class="panel">
                        <h3>Position vs Time Graph</h3>
                        <div class="canvas-container">
                            <canvas id="springGraphs" width="500" height="300"></canvas>
                        </div>
                    </div>

                    <div class="panel">
                        <h3>Theory & Formulas</h3>
                        <div class="theory-content">
                            <div class="formula-box">
                                <strong>Equation Of Motion:</strong><br>
                                $m\dfrac{d^2x}{dt^2} = -kx$
                            </div>
                            <div class="formula-box">
                                <strong>Angular Frequency:</strong><br>
                                $\omega = \sqrt{\dfrac{k}{m}}$
                            </div>
                            <div class="formula-box">
                                <strong>Solution:</strong><br>
                                $x(t) = A\cos(\omega t + \phi)$<br>
                                where $A = \sqrt{x_0^2 + \left(\dfrac{v_0}{\omega}\right)^2}$<br>
                                and $\phi = -\arctan\left(\dfrac{v_0}{\omega x_0}\right)$
                            </div>
                            <div class="formula-box">
                                <strong>Period, Frequency:</strong><br>
                                $T = \dfrac{2\pi}{\omega}$, $\nu = \dfrac{\omega}{2\pi}$
                            </div>
                        </div>
                        
                        <!-- PDF Link Section -->
                        <div style="margin-top: 20px; padding-top: 15px; border-top: 2px solid #ecf0f1;">
                            <h4 style="color: #2c3e50; margin-bottom: 10px;">üìö Advanced Theory</h4>
                            <a href="https://drive.google.com/file/d/10wzhSBtKJcoXHLzGR8qZr6jcoo_URwbh/view?usp=sharing" target="_blank" class="calculate-btn" style="background: #8e44ad; margin-bottom: 5px; text-decoration: none; display: inline-block; text-align: center;">
                                üìÑ Mass-Spring Theory (PDF)
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lens Simulation -->
        <div class="simulation-page" id="lens">
            <div class="sim-header">
                <h2>Lens</h2>
                <button class="back-btn" onclick="showMainMenu()">‚Üê Back to Menu</button>
            </div>
            <div class="sim-content">
                <div class="left-panel">
                    <!-- Input Panel -->
                    <div class="panel">
                        <h3>Input Parameters (Centimeter is default)</h3>
                        <div class="input-group">
                            <label>$s$ - Object Distance $(\mathrm{m})$ (work only $s>0$):</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="lenss" value="2" step="0.1" style="flex: 1;">
                                <span style="font-weight: bold;">√ó10</span>
                                <input type="number" id="lenss_exp" value="-2" step="1" style="width: 60px;" title="Power of 10">
                            </div>
                        </div>
                        <div class="input-group">
                            <label>$h$ - Object Height $(\mathrm{m})$:</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="lensh" value="1" step="0.001" style="flex: 1;">
                                <span style="font-weight: bold;">√ó10</span>
                                <input type="number" id="lensh_exp" value="-2" step="1" style="width: 60px;" title="Power of 10">
                            </div>
                        </div>
                        <div class="input-group">
                            <label>$f$ - Focal Length $(\mathrm{m})$ (+ for convex, - for concave ):</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="lensf" value="1" step="0.001" style="flex: 1;">
                                <span style="font-weight: bold;">√ó10</span>
                                <input type="number" id="lensf_exp" value="-2" step="1" style="width: 60px;" title="Power of 10">
                            </div>
                        </div>
                        <button class="calculate-btn" onclick="calculateLens()">Calculate</button>
                    </div>

                    <!-- Output Panel -->
                    <div class="panel">
                        <h3>Results</h3>
                        <div id="lensResults">
                            <div class="output-item">Click "Calculate" to see results</div>
                        </div>
                    </div>
                </div>

                <div class="right-panel">
                    <!-- Simulation Panel -->
                    <div class="panel">
                        <h3>Simulation (Thin lens)</h3>
                        <div class="canvas-container">
                            <canvas id="lensCanvas" width="400" height="300"></canvas>
                            <div style="margin-top: 10px;">
                                <button class="calculate-btn" onclick="animateLens()" style="width: auto; padding: 8px 16px; margin: 5px;">‚ñ∂Ô∏è Start</button>
                            </div>
                        </div>
                    </div>

                    <!-- Theory Panel -->
                    <div class="panel">
                        <h3>Theory & Formulas</h3>
                        <div class="theory-content">
                            <div class="formula-box">
                                <strong>Lens Formula:</strong><br>
                                $\dfrac{1}{s}+\dfrac{1}{s'}=\dfrac{1}{f}$<br>
                            </div>
                            <div class="formula-box">
                                <strong>Key Results:</strong><br>
                                Image Distance: $s' = \dfrac{fs}{s-f}$<br>
                                Magnification: $M = -\dfrac{s'}{s} = \dfrac{h'}{h} = - \dfrac{f}{s-f}$<br>
                                Image Height: $h' = \dfrac{hf}{f-s}$
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Curved Mirror Simulation -->
        <div class="simulation-page" id="mirror">
            <div class="sim-header">
                <h2>Curved Mirror</h2>
                <button class="back-btn" onclick="showMainMenu()">‚Üê Back to Menu</button>
            </div>
            <div class="sim-content">
                <div class="left-panel">
                    <!-- Input Panel -->
                    <div class="panel">
                        <h3>Input Parameters (Centimeter is default)</h3>
                        <div class="input-group">
                            <label>$s$ - Object Distance $(\mathrm{m})$ (work only $s>0$):</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="mirrors" value="2" step="0.1" style="flex: 1;">
                                <span style="font-weight: bold;">√ó10</span>
                                <input type="number" id="mirrors_exp" value="-2" step="1" style="width: 60px;" title="Power of 10">
                            </div>
                        </div>
                        <div class="input-group">
                            <label>$h$ - Object Height $(\mathrm{m})$:</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="mirrorh" value="1" step="0.001" style="flex: 1;">
                                <span style="font-weight: bold;">√ó10</span>
                                <input type="number" id="mirrorh_exp" value="-2" step="1" style="width: 60px;" title="Power of 10">
                            </div>
                        </div>
                        <div class="input-group">
                            <label>$R$ - Radius of curvature $(\mathrm{m})$ (+ for concave, - for convex ):</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="mirrorR" value="1" step="0.001" style="flex: 1;">
                                <span style="font-weight: bold;">√ó10</span>
                                <input type="number" id="mirrorR_exp" value="-2" step="1" style="width: 60px;" title="Power of 10">
                            </div>
                        </div>
                        <button class="calculate-btn" onclick="calculateMirror()">Calculate</button>
                    </div>

                    <!-- Output Panel -->
                    <div class="panel">
                        <h3>Results</h3>
                        <div id="mirrorResults">
                            <div class="output-item">Click "Calculate" to see results</div>
                        </div>
                    </div>
                </div>

                <div class="right-panel">
                    <!-- Simulation Panel -->
                    <div class="panel">
                        <h3>Simulation (Large mirror)</h3>
                        <div class="canvas-container">
                            <canvas id="mirrorCanvas" width="400" height="300"></canvas>
                            <div style="margin-top: 10px;">
                                <button class="calculate-btn" onclick="animateMirror()" style="width: auto; padding: 8px 16px; margin: 5px;">‚ñ∂Ô∏è Start</button>
                            </div>
                        </div>
                    </div>

                    <!-- Theory Panel -->
                    <div class="panel">
                        <h3>Theory & Formulas</h3>
                        <div class="theory-content">
                            <div class="formula-box">
                                <strong>Curved Mirror Formula:</strong><br>
                                $\dfrac{1}{s}+\dfrac{1}{s'}=\dfrac{2}{R}$<br>
                            </div>
                            <div class="formula-box">
                                <strong>Key Results:</strong><br>
                                Image Distance: $s' = \dfrac{Rs}{2s-R}$<br>
                                Magnification: $M = -\dfrac{s'}{s} = \dfrac{h'}{h} = - \dfrac{R}{2s-R}$<br>
                                Image Height: $h' = \dfrac{Rh}{R-2s}$
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global animation variables
        let animationId = null;
        let springAnimationId = null;
        let projectileIsPaused = false;
        let springIsPaused = false;
        
        // Navigation functions
        function showTab(tabName) {
            // Stop all animations when switching tabs
            stopAnimation();
            stopSpringAnimation();
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(el => el.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // If switching to simulations tab, show main menu
            if (tabName === 'simulations') {
                showMainMenu();
            } else {
                // Hide all simulation pages when switching to other tabs
                document.querySelectorAll('.simulation-page').forEach(el => el.classList.remove('active'));
                document.getElementById('mainMenu').classList.remove('active');
            }
        }
        
        function showMainMenu() {
            document.querySelectorAll('.main-menu, .simulation-page').forEach(el => el.classList.remove('active'));
            document.getElementById('mainMenu').classList.add('active');
        }

        function showSimulation(simType) {
            document.querySelectorAll('.main-menu, .simulation-page').forEach(el => el.classList.remove('active'));
            document.getElementById(simType).classList.add('active');
        }

        // Pause/Resume functions
        function toggleProjectilePause() {
            projectileIsPaused = !projectileIsPaused;
            const btn = document.getElementById('projectilePauseBtn');
            btn.textContent = projectileIsPaused ? '‚ñ∂Ô∏è Resume' : '‚è∏Ô∏è Pause';
        }

        function toggleSpringPause() {
            springIsPaused = !springIsPaused;
            const btn = document.getElementById('springPauseBtn');
            btn.textContent = springIsPaused ? '‚ñ∂Ô∏è Resume' : '‚è∏Ô∏è Pause';
        }

        // Feedback System Variables
        let currentRating = 0;
        let isAdmin = false;

        // Star Rating Functions
        function setRating(rating) {
            currentRating = rating;
            updateStarDisplay(rating);

            const ratingTexts = {
                1: "Poor - We'll work to improve",
                2: "Fair - There's room for improvement",
                3: "Good - Thanks for your feedback",
                4: "Very Good - We're glad you enjoyed it",
                5: "Excellent - Thank you so much!"
            };

            document.getElementById('ratingText').textContent = ratingTexts[rating];
        }

        function updateStarDisplay(tempRating = currentRating) {
            const stars = document.querySelectorAll('.star');
            stars.forEach((star, index) => {
                // set filled vs empty glyph
                if (index < tempRating) {
                    star.textContent = '‚òÖ';    // filled star
                    star.classList.add('active');
                } else {
                    star.textContent = '‚òÜ';    // hollow star for "dark" star
                    star.classList.remove('active');
                }
            });
        }

        function initializeStarDisplay() {
            const stars = document.querySelectorAll('.star');
            stars.forEach(star => {
                star.classList.remove('active');
                star.textContent = '‚òÜ'; // start as hollow black star

                // Hover lights up temporary stars
                star.addEventListener('mouseover', () => {
                    updateStarDisplay(parseInt(star.dataset.rating, 10));
                });

                // On mouse out, revert to saved rating
                star.addEventListener('mouseout', () => {
                    updateStarDisplay();
                });

                // allow keyboard accessibility (space/enter to set rating)
                star.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        setRating(parseInt(star.dataset.rating, 10));
                    }
                });
                star.setAttribute('tabindex', '0');
            });

            currentRating = 0;
            document.getElementById('ratingText').textContent = 'Click on stars to rate';
        }

        document.addEventListener('DOMContentLoaded', initializeStarDisplay);

        // Submit Feedback
        async function submitFeedback() {
            if (currentRating === 0) {
                alert('Please select a rating before submitting');
                return;
            }

            const comment = document.getElementById('feedbackComment').value.trim();
            const submitBtn = document.getElementById('submitFeedback');
            
            // Disable button and show loading
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            try {
                const { collection, addDoc } = window.firebaseModules;
                
                await addDoc(collection(window.db, 'feedback'), {
                    rating: currentRating,
                    comment: comment,
                    timestamp: new Date(),
                    userAgent: navigator.userAgent
                });

                // Show success message
                document.getElementById('feedbackForm').style.display = 'none';
                document.getElementById('feedbackSuccess').style.display = 'block';

                // Reset form after delay
                setTimeout(() => {
                    resetFeedbackForm();
                }, 3000);

            } catch (error) {
                console.error('Error submitting feedback:', error);
                alert('Error submitting feedback. Please try again.');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Feedback';
            }
        }

        function resetFeedbackForm() {
            document.getElementById('feedbackForm').style.display = 'block';
            document.getElementById('feedbackSuccess').style.display = 'none';
            document.getElementById('feedbackComment').value = '';
            document.getElementById('submitFeedback').disabled = false;
            document.getElementById('submitFeedback').textContent = 'Submit Feedback';
            initializeStarDisplay();
        }

        // Admin Functions
        function showAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'block';
        }

        function closeAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'none';
            document.getElementById('adminEmail').value = '';
            document.getElementById('adminPassword').value = '';
        }

        async function adminLogin() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;

            if (!email || !password) {
                alert('Please enter both email and password');
                return;
            }

            try {
                const { signInWithEmailAndPassword } = window.firebaseModules;
                await signInWithEmailAndPassword(window.auth, email, password);
                
                // Login successful - will be handled by auth state change
                closeAdminLogin();
                
            } catch (error) {
                console.error('Login error:', error);
                alert('Invalid credentials. Please try again.');
            }
        }

        async function adminLogout() {
            try {
                const { signOut } = window.firebaseModules;
                await signOut(window.auth);
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        async function loadAdminDashboard() {
            try {
                const { collection, getDocs, query, orderBy } = window.firebaseModules;
                const feedbackQuery = query(collection(window.db, 'feedback'), orderBy('timestamp', 'desc'));
                const querySnapshot = await getDocs(feedbackQuery);
                
                const feedbacks = [];
                let totalRating = 0;
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    feedbacks.push(data);
                    totalRating += data.rating;
                });

                // Update statistics
                document.getElementById('totalFeedback').textContent = feedbacks.length;
                const avgRating = feedbacks.length > 0 ? (totalRating / feedbacks.length).toFixed(1) : '0.0';
                document.getElementById('averageRating').textContent = avgRating + ' ‚òÖ';

                // Update feedback list
                const feedbackList = document.getElementById('feedbackList');
                if (feedbacks.length === 0) {
                    feedbackList.innerHTML = '<p style="text-align: center; color: #666; font-style: italic;">No feedback yet</p>';
                } else {
                    feedbackList.innerHTML = feedbacks.map(feedback => {
                        const date = feedback.timestamp.toDate().toLocaleDateString();
                        const time = feedback.timestamp.toDate().toLocaleTimeString();
                        const stars = '‚òÖ'.repeat(feedback.rating) + '‚òÜ'.repeat(5 - feedback.rating);

                        // choose comment color by rating: 5/4 -> greenish, 3 -> orange, 1/2 -> red
                        let commentColor = '#2c3e50'; // default (dark)
                        if (feedback.rating >= 4) commentColor = '#1e7e34';       // green
                        else if (feedback.rating === 3) commentColor = '#e67e22'; // orange
                        else commentColor = '#c0392b';                           // red

                        return `
                            <div style="background: white; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #0066ff;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <span style="font-size: 1.2em; color: #333;">${stars}</span>
                                    <span style="color: #666; font-size: 0.9em;">${date} ${time}</span>
                                </div>
                                ${feedback.comment ? `<p style="color: ${commentColor}; margin: 0; font-style: italic;">"${feedback.comment}"</p>`
                                                    : '<p style="color: #999; margin: 0; font-style: italic;">No comment provided</p>'}
                            </div>
                        `;
                    }).join('');
                }

            } catch (error) {
                console.error('Error loading dashboard:', error);
                alert('Error loading dashboard data');
            }
        }

        // Initialize Firebase Auth State Listener
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (window.firebaseModules && window.auth) {
                    const { onAuthStateChanged } = window.firebaseModules;
                    onAuthStateChanged(window.auth, (user) => {
                        if (user && user.email === 'physicas.photon@gmail.com') {
                            // Admin logged in
                            isAdmin = true;
                            document.getElementById('feedbackForm').style.display = 'none';
                            document.getElementById('feedbackSuccess').style.display = 'none';
                            document.getElementById('adminLoginBtn').style.display = 'none';
                            document.getElementById('adminDashboard').style.display = 'block';
                            loadAdminDashboard();
                        } else {
                            // User logged out or not admin
                            isAdmin = false;
                            document.getElementById('feedbackForm').style.display = 'block';
                            document.getElementById('feedbackSuccess').style.display = 'none';
                            document.getElementById('adminLoginBtn').style.display = 'block';
                            document.getElementById('adminDashboard').style.display = 'none';
                            initializeStarDisplay();
                        }
                    });
                }
            }, 1000);
        });

        //Scientific Notation in Latex
        function sciLatex(value, n = 4) {
            if (isNaN(value)) return "N/A";
    
            // n-1 decimals since toExponential counts 1 before + decimals = sig figs
            let expStr = Number(value).toExponential(n - 1);
            let [coeff, exp] = expStr.split("e");
            let exponent = parseInt(exp, 10);

            // Format LaTeX
            if (exponent === 0) {
                return coeff; // just the coefficient
            } else {
                return `${coeff} \\times 10^{${exponent}}`;
            }
        }


        // Projectile Motion Functions
        function calculateProjectile() {
            const v0 = parseFloat(document.getElementById('v0').value) * Math.pow(10, parseFloat(document.getElementById('v0_exp').value));
            const angleValue = parseFloat(document.getElementById('projectile_angle').value) * Math.pow(10, parseFloat(document.getElementById('projectile_angle_exp').value));
            const angle = angleValue * Math.PI / 180;
            const beta = parseFloat(document.getElementById('beta').value) * Math.pow(10, parseFloat(document.getElementById('beta_exp').value));
            const mass = parseFloat(document.getElementById('mass').value) * Math.pow(10, parseFloat(document.getElementById('mass_exp').value));
            const g = parseFloat(document.getElementById('g').value) * Math.pow(10, parseFloat(document.getElementById('g_exp').value));

            // Calculate basic parameters
            const v0x = v0 * Math.cos(angle);
            const v0y = v0 * Math.sin(angle);
            
            let range, maxHeight, flightTime;
            
            if (beta === 0) {
                // No air resistance - analytical solution
                flightTime = 2 * v0y / g;
                range = v0x * flightTime;
                maxHeight = (v0y * v0y) / (2 * g);
            } else {
                // With air resistance - numerical integration to find accurate values
                let t = 0;
                const dt = 0.001;
                let x = 0, y = 0;
                let vx = v0x, vy = v0y;
                let maxY = 0;
                
                // Simulate until projectile hits ground
                while (y >= 0 && t < 100) {
                    // Air resistance force components
                    const speed = Math.sqrt(vx * vx + vy * vy);
                    const dragX = -beta * vx / mass;
                    const dragY = -beta * vy / mass;
                    
                    // Update velocities
                    vx += dragX * dt;
                    vy += (dragY - g) * dt;
                    
                    // Update positions
                    x += vx * dt;
                    y += vy * dt;
                    
                    // Track maximum height
                    if (y > maxY) maxY = y;
                    
                    t += dt;
                    
                    // Stop if we've clearly hit the ground
                    if (y < 0) break;
                }
                
                flightTime = t;
                range = x;
                maxHeight = maxY;
            }

            // Display results
            const resultsDiv = document.getElementById('projectileResults');
            let dragInfo = beta === 0 ? "No air resistance" : `With air resistance: $\\beta = ${sciLatex(beta)}$`;
            
            resultsDiv.innerHTML = `
                <div class="output-item"><strong>${dragInfo}</strong></div>
                <div class="output-item"><strong>Flight Time:</strong> $\\tau = ${sciLatex(flightTime)}\\, \\mathrm{s}$</div>
                <div class="output-item"><strong>Range:</strong> $R=${sciLatex(range)}\\, \\mathrm{m}$</div>
                <div class="output-item"><strong>Maximum Height:</strong> $H=${sciLatex(maxHeight)}\\, \\mathrm{m}$</div>

            `;
            
            // Re-render MathJax
            MathJax.typesetPromise([resultsDiv]);
        }

        function animateProjectile() {
            stopAnimation();
            projectileIsPaused = false;
            document.getElementById('projectilePauseBtn').textContent = '‚è∏Ô∏è Pause';
            
            const canvas = document.getElementById('projectileCanvas');
            const ctx = canvas.getContext('2d');
            const graphCanvas = document.getElementById('projectileGraphs');
            const graphCtx = graphCanvas.getContext('2d');
            
            const v0 = parseFloat(document.getElementById('v0').value) * Math.pow(10, parseFloat(document.getElementById('v0_exp').value));
            const angleValue = parseFloat(document.getElementById('projectile_angle').value) * Math.pow(10, parseFloat(document.getElementById('projectile_angle_exp').value));
            const angle = angleValue * Math.PI / 180;
            const beta = parseFloat(document.getElementById('beta').value) * Math.pow(10, parseFloat(document.getElementById('beta_exp').value));
            const mass = parseFloat(document.getElementById('mass').value) * Math.pow(10, parseFloat(document.getElementById('mass_exp').value));
            const g = parseFloat(document.getElementById('g').value) * Math.pow(10, parseFloat(document.getElementById('g_exp').value));
            const timeSpeed = parseFloat(document.getElementById('timeSpeed').value);
            
            const v0x = v0 * Math.cos(angle);
            const v0y = v0 * Math.sin(angle);
            const scale = 8; // pixels per meter
            
            let t = 0;
            const dt = 0.02 * timeSpeed;
            let vx = v0x, vy = v0y;
            let x = 0, y = 0;
            
            const xData = [], yData = [], timeData = [];
            
            function animate() {
                if (projectileIsPaused) {
                    animationId = requestAnimationFrame(animate);
                    return;
                }
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw coordinate axes
                ctx.strokeStyle = '#34495e';
                ctx.lineWidth = 1;
                ctx.setLineDash([2, 2]);
                // X-axis
                ctx.beginPath();
                ctx.moveTo(20, canvas.height - 20);
                ctx.lineTo(canvas.width - 20, canvas.height - 20);
                ctx.stroke();
                // Y-axis
                ctx.beginPath();
                ctx.moveTo(20, 20);
                ctx.lineTo(20, canvas.height - 20);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Draw axis labels
                ctx.fillStyle = '#2c3e50';
                ctx.font = '12px Computer Modern';
                ctx.fillText('x (m)', canvas.width - 40, canvas.height - 5);
                ctx.fillText('y (m)', 5, 15);
                
                // Calculate dynamic scale based on current trajectory
                const maxXSeen = Math.max(...xData, x, 10);
                const maxYSeen = Math.max(...yData, y, 5);
                const dynamicScaleX = (canvas.width - 60) / maxXSeen;
                const dynamicScaleY = (canvas.height - 60) / maxYSeen;
                const currentScale = Math.min(dynamicScaleX, dynamicScaleY, scale);
                
                // Draw scale markers with dynamic scaling
                const xStep = Math.ceil(maxXSeen / 8);
                const yStep = Math.ceil(maxYSeen / 6);
                
                for (let i = 1; i <= Math.ceil(maxXSeen / xStep); i++) {
                    const xPos = 20 + i * xStep * currentScale;
                    if (xPos < canvas.width - 20) {
                        ctx.fillText((i * xStep).toFixed(0), xPos - 5, canvas.height - 5);
                        // Draw grid line
                        ctx.strokeStyle = '#ecf0f1';
                        ctx.setLineDash([1, 3]);
                        ctx.beginPath();
                        ctx.moveTo(xPos, 20);
                        ctx.lineTo(xPos, canvas.height - 20);
                        ctx.stroke();
                        ctx.setLineDash([]);
                    }
                }
                
                for (let i = 1; i <= Math.ceil(maxYSeen / yStep); i++) {
                    const yPos = canvas.height - 20 - i * yStep * currentScale;
                    if (yPos > 20) {
                        ctx.fillText((i * yStep).toFixed(0), 2, yPos + 3);
                        // Draw grid line
                        ctx.strokeStyle = '#ecf0f1';
                        ctx.setLineDash([1, 3]);
                        ctx.beginPath();
                        ctx.moveTo(20, yPos);
                        ctx.lineTo(canvas.width - 20, yPos);
                        ctx.stroke();
                        ctx.setLineDash([]);
                    }
                }
                
                // Draw trajectory path
                ctx.strokeStyle = '#3498db';
                ctx.lineWidth = 2;
                ctx.beginPath();
                let pathT = 0;
                let pathVx = v0x, pathVy = v0y;
                let pathX = 0, pathY = 0;
                ctx.moveTo(20, canvas.height - 20);
                
                while (pathY >= 0 && pathT < 20) {
                    if (beta > 0) {
                        const speed = Math.sqrt(pathVx * pathVx + pathVy * pathVy);
                        const dragX = -beta * pathVx / mass;
                        const dragY = -beta * pathVy / mass;
                        pathVx += dragX * dt;
                        pathVy += (dragY - g) * dt;
                    } else {
                        pathVy -= g * dt;
                    }
                    
                    pathX += pathVx * dt;
                    pathY += pathVy * dt;
                    
                    if (pathY >= 0) {
                        ctx.lineTo(20 + pathX * currentScale, canvas.height - 20 - pathY * currentScale);
                    }
                    pathT += dt;
                }
                ctx.stroke();
                
                // Update projectile position
                if (beta > 0) {
                    const speed = Math.sqrt(vx * vx + vy * vy);
                    const dragX = -beta * vx / mass;
                    const dragY = -beta * vy / mass;
                    vx += dragX * dt;
                    vy += (dragY - g) * dt;
                } else {
                    vy -= g * dt;
                }
                
                x += vx * dt;
                y += vy * dt;
                
                // Store data for graphs
                timeData.push(t);
                xData.push(x);
                yData.push(y);
                
                // Draw projectile
                if (y >= 0) {
                    ctx.fillStyle = '#e74c3c';
                    ctx.beginPath();
                    ctx.arc(20 + x * currentScale, canvas.height - 20 - y * currentScale, 6, 0, 2 * Math.PI);
                    ctx.fill();
                    
                    // Draw velocity vector with fixed size
                    const speed = Math.sqrt(vx * vx + vy * vy);
                    if (speed > 0.1) { // Only draw if there's meaningful velocity
                        ctx.strokeStyle = '#27ae60';
                        ctx.lineWidth = 4;
                        ctx.beginPath();
                        ctx.moveTo(20 + x * currentScale, canvas.height - 20 - y * currentScale);
                        
                        // Fixed vector length of 40 pixels, direction based on velocity
                        const fixedVecLength = 40;
                        const vecAngle = Math.atan2(-vy, vx);
                        const vecEndX = 20 + x * currentScale + fixedVecLength * Math.cos(vecAngle);
                        const vecEndY = canvas.height - 20 - y * currentScale + fixedVecLength * Math.sin(vecAngle);
                        ctx.lineTo(vecEndX, vecEndY);
                        ctx.stroke();
                        
                        // Draw velocity vector arrow
                        ctx.fillStyle = '#27ae60';
                        ctx.beginPath();
                        ctx.moveTo(vecEndX, vecEndY);
                        ctx.lineTo(vecEndX - 12 * Math.cos(vecAngle - 0.3), vecEndY - 12 * Math.sin(vecAngle - 0.3));
                        ctx.lineTo(vecEndX - 12 * Math.cos(vecAngle + 0.3), vecEndY - 12 * Math.sin(vecAngle + 0.3));
                        ctx.closePath();
                        ctx.fill();
                    }
                    
                    // Update time display
                    document.getElementById('projectileTime').textContent = t.toFixed(2);
                    
                    // Draw graphs
                    drawProjectileGraphs(graphCtx, timeData, xData, yData);
                    
                    t += dt;
                    animationId = requestAnimationFrame(animate);
                }
            }
            
            animate();
        }
        
        function drawProjectileGraphs(ctx, timeData, xData, yData) {
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
            
            if (timeData.length < 2) return;
            
            const margin = 60;
            const graphWidth = (ctx.canvas.width - 3 * margin) / 2;
            const graphHeight = ctx.canvas.height - 2 * margin;
            
            // Find max values for scaling
            const maxTime = Math.max(...timeData);
            const maxX = Math.max(...xData);
            const maxY = Math.max(...yData);
            
            ctx.font = '12px Computer Modern';
            ctx.fillStyle = '#2c3e50';
            
            // Draw x(t) graph
            ctx.strokeStyle = '#34495e';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.rect(margin, margin, graphWidth, graphHeight);
            ctx.stroke();
            
            // Draw x(t) grid and labels
            for (let i = 0; i <= 5; i++) {
                const timeVal = (maxTime * i) / 5;
                const xPos = margin + (i / 5) * graphWidth;
                ctx.strokeStyle = '#ecf0f1';
                ctx.beginPath();
                ctx.moveTo(xPos, margin);
                ctx.lineTo(xPos, margin + graphHeight);
                ctx.stroke();
                ctx.fillText(timeVal.toFixed(1), xPos - 10, margin + graphHeight + 15);
                
                const xVal = (maxX * i) / 5;
                const yPos = margin + graphHeight - (i / 5) * graphHeight;
                ctx.strokeStyle = '#ecf0f1';
                ctx.beginPath();
                ctx.moveTo(margin, yPos);
                ctx.lineTo(margin + graphWidth, yPos);
                ctx.stroke();
                ctx.fillText(xVal.toFixed(1), margin - 35, yPos + 4);
            }
            
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 4;
            ctx.beginPath();
            for (let i = 0; i < timeData.length; i++) {
                const plotX = margin + (timeData[i] / maxTime) * graphWidth;
                const plotY = margin + graphHeight - (xData[i] / maxX) * graphHeight;
                if (i === 0) ctx.moveTo(plotX, plotY);
                else ctx.lineTo(plotX, plotY);
            }
            ctx.stroke();
            
            ctx.fillText('x(t) [m]', margin + graphWidth/2 - 15, margin - 20);
            ctx.fillText('t [s]', margin + graphWidth/2 - 10, margin + graphHeight + 35);
            
            // Draw y(t) graph
            const graph2X = margin * 2 + graphWidth;
            ctx.strokeStyle = '#34495e';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.rect(graph2X, margin, graphWidth, graphHeight);
            ctx.stroke();
            
            // Draw y(t) grid and labels
            for (let i = 0; i <= 5; i++) {
                const timeVal = (maxTime * i) / 5;
                const xPos = graph2X + (i / 5) * graphWidth;
                ctx.strokeStyle = '#ecf0f1';
                ctx.beginPath();
                ctx.moveTo(xPos, margin);
                ctx.lineTo(xPos, margin + graphHeight);
                ctx.stroke();
                ctx.fillText(timeVal.toFixed(1), xPos - 10, margin + graphHeight + 15);
                
                const yVal = (maxY * i) / 5;
                const yPos = margin + graphHeight - (i / 5) * graphHeight;
                ctx.strokeStyle = '#ecf0f1';
                ctx.beginPath();
                ctx.moveTo(graph2X, yPos);
                ctx.lineTo(graph2X + graphWidth, yPos);
                ctx.stroke();
                ctx.fillText(yVal.toFixed(1), graph2X - 35, yPos + 4);
            }
            
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 4;
            ctx.beginPath();
            for (let i = 0; i < timeData.length; i++) {
                const plotX = graph2X + (timeData[i] / maxTime) * graphWidth;
                const plotY = margin + graphHeight - (yData[i] / maxY) * graphHeight;
                if (i === 0) ctx.moveTo(plotX, plotY);
                else ctx.lineTo(plotX, plotY);
            }
            ctx.stroke();
            
            ctx.fillText('y(t) [m]', graph2X + graphWidth/2 - 15, margin - 20);
            ctx.fillText('t [s]', graph2X + graphWidth/2 - 10, margin + graphHeight + 35);
        }

        function stopAnimation() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        }

        // Mass-Spring System Functions
        function calculateSpring() {
            const m = parseFloat(document.getElementById('springMass').value) * Math.pow(10, parseFloat(document.getElementById('springMass_exp').value));
            const k = parseFloat(document.getElementById('springK').value) * Math.pow(10, parseFloat(document.getElementById('springK_exp').value));
            const x0 = parseFloat(document.getElementById('springX0').value) * Math.pow(10, parseFloat(document.getElementById('springX0_exp').value));
            const v0 = parseFloat(document.getElementById('springV0').value) * Math.pow(10, parseFloat(document.getElementById('springV0_exp').value));
            
            const omega = Math.sqrt(k / m);
            const period = 2 * Math.PI / omega;
            const frequency = omega / (2 * Math.PI);
            
            let A, phi;
            
            A = Math.sqrt(x0 * x0 + (v0 / omega) * (v0 / omega));
                if (x0 !== 0) {
                    phi = Math.atan(-v0 / (omega * x0));
                } else if (v0 > 0) {
                    phi = -Math.PI / 2;
                } else if (v0 < 0) {
                    phi = Math.PI / 2;
                }
            
            // Display results
            const resultsDiv = document.getElementById('springResults');
            let resultsHTML = `
                <div class="output-item"><strong>Angular Frequency:</strong> $\\omega=${sciLatex(omega)}\\, \\mathrm{rad{\\cdot}s^{-1}}$</div>
                <div class="output-item"><strong>Period:</strong> $T=${sciLatex(period)}\\, \\mathrm{s}$</div>
                <div class="output-item"><strong>Frequency:</strong> $\\nu=${sciLatex(frequency)}\\, \\mathrm{s^{-1}}$</div>
                <div class="output-item"><strong>Amplitude:</strong> $A=${sciLatex(A)}\\, \\mathrm{m}$</div>
                <div class="output-item"><strong>Phase Angle:</strong> $\\phi=${sciLatex(phi)}\\, \\mathrm{rad}$</div>
                `;
            
            resultsDiv.innerHTML = resultsHTML;
            
            MathJax.typesetPromise([resultsDiv]);
        }

        function animateSpring() {
            stopSpringAnimation();
            springIsPaused = false;
            document.getElementById('springPauseBtn').textContent = '‚è∏Ô∏è Pause';
            
            const canvas = document.getElementById('springCanvas');
            const ctx = canvas.getContext('2d');
            const graphCanvas = document.getElementById('springGraphs');
            const graphCtx = graphCanvas.getContext('2d');
            
            const mass = parseFloat(document.getElementById('springMass').value) * Math.pow(10, parseFloat(document.getElementById('springMass_exp').value));
            const k = parseFloat(document.getElementById('springK').value) * Math.pow(10, parseFloat(document.getElementById('springK_exp').value));
            const x0 = parseFloat(document.getElementById('springX0').value) * Math.pow(10, parseFloat(document.getElementById('springX0_exp').value));
            const v0 = parseFloat(document.getElementById('springV0').value) * Math.pow(10, parseFloat(document.getElementById('springV0_exp').value));
            const timeSpeed = parseFloat(document.getElementById('springTimeSpeed').value);
            
            const omega = Math.sqrt(k / mass);
            const A = Math.sqrt(x0 * x0 + (v0 / omega) * (v0 / omega));
            let phi = 0;
            if (x0 !== 0) {
                phi = Math.atan(-v0 / (omega * x0));
            } else if (v0 > 0) {
                phi = -Math.PI / 2;
            } else if (v0 < 0) {
                phi = Math.PI / 2;
            }
            
            const scale = 800; // pixels per meter
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            let t = 0;
            const dt = 0.02 * timeSpeed;
            const xData = [], timeData = [];
            
            function animate() {
                if (springIsPaused) {
                    springAnimationId = requestAnimationFrame(animate);
                    return;
                }
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Calculate position and velocity
                let x, v;
                x = A * Math.cos(omega * t + phi);
                v = -A * omega * Math.sin(omega * t + phi);
                
                // Store data for graph
                timeData.push(t);
                xData.push(x);
                
                // Draw wall - made taller and positioned further left
                ctx.fillStyle = '#7f8c8d';
                ctx.fillRect(30, centerY - 80, 25, 160);
                
                // Draw x-axis - extended to cover more range
                ctx.strokeStyle = '#34495e';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(55, centerY);
                ctx.lineTo(canvas.width - 30, centerY);
                ctx.stroke();
                
                // Calculate dynamic scale for spring system with more generous boundaries
                const maxXSpring = Math.max(...xData.map(Math.abs), Math.abs(x), 0.1);
                const availableWidth = canvas.width - 160; // More space for oscillation
                const dynamicSpringScale = Math.min(scale, availableWidth / (3 * maxXSpring)); // 3x amplitude for comfortable viewing
                
                // Draw x-axis scale markers with more spacing and fewer divisions
                ctx.fillStyle = '#2c3e50';
                ctx.font = '12px Computer Modern';
                
                const equilibriumX = 200; // Equilibrium position
                const numDivisions = 3; // Reduced from 5 to 3 for more spacing
                
                for (let i = -numDivisions; i <= numDivisions; i++) {
                    if (i !== 0) {
                        const xValue = (i / numDivisions) * maxXSpring;
                        const xPos = equilibriumX + xValue * dynamicSpringScale;
                        if (xPos > 80 && xPos < canvas.width - 50) {
                            ctx.strokeStyle = '#34495e';
                            ctx.lineWidth = 2;
                            ctx.beginPath();
                            ctx.moveTo(xPos, centerY - 5);
                            ctx.lineTo(xPos, centerY + 5);
                            ctx.stroke();
                            
                            ctx.fillText(xValue.toFixed(3), xPos - 15, centerY + 20);
                            
                            // Draw grid line with more spacing
                            ctx.strokeStyle = '#ecf0f1';
                            ctx.lineWidth = 1;
                            ctx.setLineDash([1, 3]);
                            ctx.beginPath();
                            ctx.moveTo(xPos, centerY - 50);
                            ctx.lineTo(xPos, centerY + 50);
                            ctx.stroke();
                            ctx.setLineDash([]);
                        }
                    }
                }
                ctx.fillText('x (m)', canvas.width - 35, centerY + 20);
                ctx.fillText('0', equilibriumX - 8, centerY + 20);
                
                // Draw spring
                ctx.strokeStyle = '#34495e';
                ctx.lineWidth = 3;
                ctx.beginPath();
                
                const naturalLength = 145; // Natural spring length from wall to equilibrium
                const springLength = naturalLength + x * dynamicSpringScale;
                const coils = 10; // More coils for better visual
                const coilWidth = 18;
                
                ctx.moveTo(55, centerY);
                for (let i = 0; i < coils; i++) {
                    const segmentLength = springLength / coils;
                    const startX = 55 + i * segmentLength;
                    const endX = startX + segmentLength;
                    const midX = (startX + endX) / 2;
                    
                    if (i % 2 === 0) {
                        ctx.lineTo(midX, centerY - coilWidth);
                        ctx.lineTo(endX, centerY);
                    } else {
                        ctx.lineTo(midX, centerY + coilWidth);
                        ctx.lineTo(endX, centerY);
                    }
                }
                ctx.stroke();
                
                // Draw mass
                const massX = 55 + springLength;
                ctx.fillStyle = '#e74c3c';
                ctx.fillRect(massX - 15, centerY - 15, 30, 30);
                
                // Draw velocity vector with fixed size
                if (Math.abs(v) > 0.01) {
                    ctx.strokeStyle = '#27ae60';
                    ctx.lineWidth = 5;
                    ctx.beginPath();
                    ctx.moveTo(massX, centerY);
                    
                    // Fixed vector length of 50 pixels, direction based on velocity
                    const fixedVecLength = 50;
                    const vecEndX = massX + (v > 0 ? fixedVecLength : -fixedVecLength);
                    ctx.lineTo(vecEndX, centerY);
                    ctx.stroke();
                    
                    // Draw arrow
                    ctx.fillStyle = '#27ae60';
                    ctx.beginPath();
                    ctx.moveTo(vecEndX, centerY);
                    if (v > 0) {
                        ctx.lineTo(vecEndX - 15, centerY - 8);
                        ctx.lineTo(vecEndX - 15, centerY + 8);
                    } else {
                        ctx.lineTo(vecEndX + 15, centerY - 8);
                        ctx.lineTo(vecEndX + 15, centerY + 8);
                    }
                    ctx.closePath();
                    ctx.fill();
                }
                
                // Draw equilibrium position marker
                ctx.strokeStyle = '#95a5a6';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(equilibriumX, centerY - 50);
                ctx.lineTo(equilibriumX, centerY + 50);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Mark equilibrium position
                ctx.fillStyle = '#95a5a6';
                ctx.font = '12px Computer Modern';
                ctx.fillText('Equilibrium', equilibriumX + 5, centerY - 55);
                
                // Draw position and time indicators
                ctx.fillStyle = '#2c3e50';
                ctx.font = '14px Computer Modern';
                ctx.fillText(`x = ${x.toFixed(4)} m`, 10, 30);
                ctx.fillText(`v = ${v.toFixed(4)} m/s`, 10, 50);
                
                // Update time display
                document.getElementById('springTime').textContent = t.toFixed(2);
                
                // Draw graph
                drawSpringGraph(graphCtx, timeData, xData);
                
                t += dt;
                springAnimationId = requestAnimationFrame(animate);
            }
            
            animate();
        }
        
        function drawSpringGraph(ctx, timeData, xData) {
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
            
            if (timeData.length < 2) return;
            
            const margin = 60;
            const graphWidth = ctx.canvas.width - 2 * margin;
            const graphHeight = ctx.canvas.height - 2 * margin;
            
            // Find max values for scaling
            const maxTime = Math.max(...timeData);
            const maxX = Math.max(...xData.map(Math.abs));
            
            ctx.font = '12px Computer Modern';
            ctx.fillStyle = '#2c3e50';
            
            // Draw main axes
            ctx.strokeStyle = '#34495e';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.rect(margin, margin, graphWidth, graphHeight);
            ctx.moveTo(margin, margin + graphHeight/2);
            ctx.lineTo(margin + graphWidth, margin + graphHeight/2);
            ctx.stroke();
            
            // Draw grid and labels for time axis
            for (let i = 0; i <= 5; i++) {
                const timeVal = (maxTime * i) / 5;
                const xPos = margin + (i / 5) * graphWidth;
                ctx.strokeStyle = '#ecf0f1';
                ctx.beginPath();
                ctx.moveTo(xPos, margin);
                ctx.lineTo(xPos, margin + graphHeight);
                ctx.stroke();
                ctx.fillText(timeVal.toFixed(1), xPos - 10, margin + graphHeight + 15);
            }
            
            // Draw grid and labels for position axis
            for (let i = 0; i <= 4; i++) {
                const xVal = (maxX * (i - 2)) / 2;
                const yPos = margin + (i / 4) * graphHeight;
                ctx.strokeStyle = '#ecf0f1';
                ctx.beginPath();
                ctx.moveTo(margin, yPos);
                ctx.lineTo(margin + graphWidth, yPos);
                ctx.stroke();
                if (i !== 2) {
                    ctx.fillText(xVal.toFixed(3), margin - 45, yPos + 4);
                }
            }
            ctx.fillText('0', margin - 15, margin + graphHeight/2 + 4);
            
            // Draw x(t) graph
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 4;
            ctx.beginPath();
            for (let i = 0; i < timeData.length; i++) {
                const plotX = margin + (timeData[i] / maxTime) * graphWidth;
                const plotY = margin + graphHeight/2 - (xData[i] / maxX) * (graphHeight/2 - 10);
                if (i === 0) ctx.moveTo(plotX, plotY);
                else ctx.lineTo(plotX, plotY);
            }
            ctx.stroke();
            
            // Labels
            ctx.fillText('x(t) [m]', margin + graphWidth/2 - 15, margin - 20);
            ctx.fillText('t [s]', margin + graphWidth/2 - 10, margin + graphHeight + 35);
        }

        function stopSpringAnimation() {
            if (springAnimationId) {
                cancelAnimationFrame(springAnimationId);
                springAnimationId = null;
            }
        }

        // Lens Functions
        function calculateLens() {
            const s = parseFloat(document.getElementById('lenss').value) * Math.pow(10, parseFloat(document.getElementById('lenss_exp').value));
            const h = parseFloat(document.getElementById('lensh').value) * Math.pow(10, parseFloat(document.getElementById('lensh_exp').value));
            const f = parseFloat(document.getElementById('lensf').value) * Math.pow(10, parseFloat(document.getElementById('lensf_exp').value));
            
            let s_image, mag, h_image;
            
            if (s>0) {
                s_image = (f*s)/(s-f);
                mag = (-f)/(s-f);
                h_image = (h*f)/(f-s);
            } else {
                s_image = 'N/A';
                mag = 'N/A';
                h_image = 'N/A';
            }
            
            
            
            // Display results
            const resultsDiv = document.getElementById('lensResults');
            let resultsHTML = `
                <div class="output-item"><strong>Image Distance:</strong> $s'=${sciLatex(s_image)}\\, \\mathrm{m}$</div>
                <div class="output-item"><strong>Magnification:</strong> $M=${sciLatex(mag)}$</div>
                <div class="output-item"><strong>Image Height:</strong> $h'=${sciLatex(h_image)}\\, \\mathrm{m}$</div>
                `;
            
            resultsDiv.innerHTML = resultsHTML;
            
            MathJax.typesetPromise([resultsDiv]);
        }

        function animateLens() {
            const canvas = document.getElementById("lensCanvas");
            const ctx = canvas.getContext("2d");
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const s = parseFloat(document.getElementById("lenss").value) * Math.pow(10, parseFloat(document.getElementById("lenss_exp").value));
            const h = parseFloat(document.getElementById("lensh").value) * Math.pow(10, parseFloat(document.getElementById("lensh_exp").value));
            const f = parseFloat(document.getElementById("lensf").value) * Math.pow(10, parseFloat(document.getElementById("lensf_exp").value));

            const s_prime = (f * s) / (s - f);
            const m = -s_prime / s;
            const h_prime = h * m;

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const maxX = Math.max(Math.abs(s), Math.abs(s_prime), Math.abs(f)) * 1.2;
            const maxY = Math.max(Math.abs(h), Math.abs(h_prime)) * 2;
            const scaleX = (canvas.width / 2 - 40) / maxX;
            const scaleY = (canvas.height / 2 - 30) / maxY;
            const scale = Math.max(10, Math.min(scaleX, scaleY));
            const X = x => centerX + x * scale;
            const Y = y => centerY - y * scale;

            // Draw legend
            ctx.fillStyle = "#333";
            ctx.font = "14px sans-serif";
            ctx.fillText("üî¥ Object", 10, 20);
            ctx.fillText("üü¢ Image", 10, 40);
            ctx.fillText("üîµ Lens Axis", 10, 60);
            ctx.fillText("üü° Ray", 10, 80);

            // Principal axis
            ctx.strokeStyle = "#333";
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(canvas.width, centerY);
            ctx.stroke();

            // Lens as blue line
            ctx.strokeStyle = "#0080ff";
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, canvas.height);
            ctx.stroke();

            // Focal points
            ctx.fillStyle = "black";
            ctx.beginPath();
            ctx.arc(X(f), centerY, 3, 0, 2 * Math.PI);
            ctx.arc(X(-f), centerY, 3, 0, 2 * Math.PI);
            ctx.fill();
            ctx.fillText("F", X(f) + 4, centerY - 6);
            ctx.fillText("F", X(-f) - 14, centerY - 6);

            // Object
            ctx.strokeStyle = "#e74c3c";
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(X(-s), centerY);
            ctx.lineTo(X(-s), Y(h));
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(X(-s), Y(h), 4, 0, 2 * Math.PI);
            ctx.fillStyle = "#e74c3c";
            ctx.fill();

            // Image
            if (s>0) {
                ctx.strokeStyle = "#27ae60";
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(X(s_prime), centerY);
            ctx.lineTo(X(s_prime), Y(h_prime));
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(X(s_prime), Y(h_prime), 4, 0, 2 * Math.PI);
            ctx.fillStyle = "#27ae60";
            ctx.fill();
            }
            
            // === Ray 1: Parallel Ray ===
            if (s>0) {
                ctx.strokeStyle = "#ff9900";
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(X(-s), Y(h));
                ctx.lineTo(X(0), Y(h));
                ctx.stroke();
            }
            
            if (s>0 && f>0) {
                if (s > f) {
                    const backLength = 1.5;
                    const angle = Math.atan2(centerY - Y(h), X(0) - X(-f));
                    const angle2 = Math.atan2(centerY - Y(h), X(0) - X(-s));
                    const endX = X(0) + backLength * scale * Math.cos(angle);
                    const endY = Y(h) + backLength * scale * Math.sin(angle);
                    const endX2 = X(-s) + backLength * scale * Math.cos(angle2);
                    const endY2 = Y(h) + backLength * scale * Math.sin(angle2);
                    // Convex: refracted through F
                    // Refracted ray (forward)
                    ctx.strokeStyle = "#ff9900"
                    ctx.beginPath();
                    ctx.moveTo(X(0), Y(h));
                    ctx.lineTo(endX, endY);
                    ctx.stroke();

                    // Refracted ray (forward)
                    ctx.strokeStyle = "#ff9900"
                    ctx.beginPath();
                    ctx.moveTo(X(-s), Y(h));
                    ctx.lineTo(endX2, endY2);
                    ctx.stroke();
                } else if (s < f) {
                    // Concave: diverge, but extend backward to F'
                    const backLength = 1.5;
                    const angle = Math.atan2(centerY - Y(h), X(0) - X(-f));
                    const angle2 = Math.atan2(centerY - Y(h), X(0) - X(-s));
                    const endX = X(0) + backLength * scale * Math.cos(angle);
                    const endY = Y(h) + backLength * scale * Math.sin(angle);
                    const endX2 = X(-s) + backLength * scale * Math.cos(angle2);
                    const endY2 = Y(h) + backLength * scale * Math.sin(angle2);

                    // Refracted ray (forward)
                    ctx.strokeStyle = "#ff9900"
                    ctx.beginPath();
                    ctx.moveTo(X(0), Y(h));
                    ctx.lineTo(endX, endY);
                    ctx.stroke();

                    // Dashed extension backward to F'
                    ctx.strokeStyle = "#ff9900"
                    ctx.setLineDash([4, 3]);
                    ctx.beginPath();
                    ctx.moveTo(X(0), Y(h));
                    ctx.lineTo(X(s_prime), Y(h_prime));
                    ctx.stroke();
                    ctx.setLineDash([]);

                    // === Ray 2: Through center ===
                    ctx.strokeStyle = "#ff9900";
                    ctx.setLineDash([4, 3]);
                    ctx.beginPath();
                    ctx.moveTo(X(-s), Y(h));
                    ctx.lineTo(X(s_prime), Y(h_prime));
                    ctx.stroke();
                    ctx.setLineDash([]);

                    // Refracted ray (forward)
                    ctx.strokeStyle = "#ff9900"
                    ctx.beginPath();
                    ctx.moveTo(X(-s), Y(h));
                    ctx.lineTo(endX2, endY2);
                    ctx.stroke();
                }
            } else if (s>0 && f<0) {
                    const backLength = 1.5;
                    const angle3 = Math.atan2(centerY - Y(-h), X(0) - X(f));
                    const angle4 = Math.atan2(centerY - Y(h), X(0) - X(-s));
                    const endX3 = X(0) + backLength * scale * Math.cos(angle3);
                    const endY3 = Y(h) + backLength * scale * Math.sin(angle3);
                    const endX4 = X(-s_prime) + backLength * scale * Math.cos(angle4);
                    const endY4 = Y(h_prime) + backLength * scale * Math.sin(angle4);
                    // Convex: refracted through F
                    ctx.strokeStyle = "#ff9900"
                    ctx.setLineDash([4, 3]);
                    ctx.beginPath();
                    ctx.moveTo(X(0), Y(h));
                    ctx.lineTo(X(s_prime), Y(h_prime));
                    ctx.stroke();
                    ctx.setLineDash([]);

                    ctx.strokeStyle = "#ff9900"
                    ctx.beginPath();
                    ctx.moveTo(X(0), Y(h));
                    ctx.lineTo(endX3, endY3);
                    ctx.stroke();

                    // === Ray 2: Through center ===
                    ctx.strokeStyle = "#ff9900";
                    ctx.beginPath();
                    ctx.moveTo(X(-s), Y(h));
                    ctx.lineTo(X(s_prime), Y(h_prime));
                    ctx.stroke();

                    ctx.strokeStyle = "#ff9900"
                    ctx.beginPath();
                    ctx.moveTo(X(s_prime), Y(h_prime));
                    ctx.lineTo(endX4, endY4);
                    ctx.stroke();
            }
        }

        // Curved Mirror Functions
        function calculateMirror() {
            const s = parseFloat(document.getElementById('mirrors').value) * Math.pow(10, parseFloat(document.getElementById('mirrors_exp').value));
            const h = parseFloat(document.getElementById('mirrorh').value) * Math.pow(10, parseFloat(document.getElementById('mirrorh_exp').value));
            const R = parseFloat(document.getElementById('mirrorR').value) * Math.pow(10, parseFloat(document.getElementById('mirrorR_exp').value));
            
            const f = R/2

            let s_image, mag, h_image;

            if (s>0) {
                s_image = (f*s)/(s-f);
                mag = (-f)/(s-f);
                h_image = (h*f)/(f-s);
            } else {
                s_image = 'N/A';
                mag = 'N/A';
                h_image = 'N/A';
            }
            
            
            
            // Display results
            const resultsDiv = document.getElementById('mirrorResults');
            let resultsHTML = `
                <div class="output-item"><strong>Image Distance:</strong> $s'=${sciLatex(s_image)}\\, \\mathrm{m}$</div>
                <div class="output-item"><strong>Magnification:</strong> $M=${sciLatex(mag)}$</div>
                <div class="output-item"><strong>Image Height:</strong> $h'=${sciLatex(h_image)}\\, \\mathrm{m}$</div>
                `;
            
            resultsDiv.innerHTML = resultsHTML;
            
            MathJax.typesetPromise([resultsDiv]);
        }

        function animateMirror() {
            const canvas = document.getElementById("mirrorCanvas");
            const ctx = canvas.getContext("2d");
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const s = parseFloat(document.getElementById("mirrors").value) * Math.pow(10, parseFloat(document.getElementById("mirrors_exp").value));
            const h = parseFloat(document.getElementById("mirrorh").value) * Math.pow(10, parseFloat(document.getElementById("mirrorh_exp").value));
            const R = parseFloat(document.getElementById("mirrorR").value) * Math.pow(10, parseFloat(document.getElementById("mirrorR_exp").value));
            const f = R/2
            const s_prime = (f * s) / (s - f);
            const m = -s_prime / s;
            const h_prime = h * m;

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const maxX = Math.max(Math.abs(s), Math.abs(s_prime), Math.abs(f)) * 1.2;
            const maxY = Math.max(Math.abs(h), Math.abs(h_prime)) * 2;
            const scaleX = (canvas.width / 2 - 40) / maxX;
            const scaleY = (canvas.height / 2 - 30) / maxY;
            const scale = Math.max(10, Math.min(scaleX, scaleY));
            const X = x => centerX + x * scale;
            const Y = y => centerY - y * scale;

            // Principal axis
            ctx.strokeStyle = "#333";
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(canvas.width, centerY);
            ctx.stroke();

            // Lens as blue line
            ctx.strokeStyle = "#0080ff";
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, canvas.height);
            ctx.stroke();

            // Center & Focal points
            ctx.fillStyle = "black";
            ctx.beginPath();
            ctx.arc(X(-R), centerY, 3, 0, 2 * Math.PI);
            ctx.arc(X(-f), centerY, 3, 0, 2 * Math.PI);
            ctx.fill();
            ctx.fillText("C", X(-R) - 14, centerY - 6);
            ctx.fillText("F", X(-f) - 14, centerY - 6);

            // Object
            ctx.strokeStyle = "#e74c3c";
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(X(-s), centerY);
            ctx.lineTo(X(-s), Y(h));
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(X(-s), Y(h), 4, 0, 2 * Math.PI);
            ctx.fillStyle = "#e74c3c";
            ctx.fill();

            // Image
            if (s>0) {
                ctx.strokeStyle = "#27ae60";
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(X(-s_prime), centerY);
            ctx.lineTo(X(-s_prime), Y(h_prime));
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(X(-s_prime), Y(h_prime), 4, 0, 2 * Math.PI);
            ctx.fillStyle = "#27ae60";
            ctx.fill();
            }
            
            // === Ray 1: Parallel Ray ===
            if (s>0) {
                ctx.strokeStyle = "#ff9900";
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(X(-s), Y(h));
                ctx.lineTo(X(0), Y(h));
                ctx.stroke();
            }
            
            if (s>0 && f>0) {
                if (s > R) {
                    const backLength = 1.5;
                    const angle = Math.atan2(centerY - Y(h), X(-f) - X(0));
                    const angle2 = Math.atan2(Y(h) - centerY, X(R) - X(s));
                    const endX = X(0) + backLength * scale * Math.cos(angle);
                    const endY = Y(h) + backLength * scale * Math.sin(angle);
                    const endX2 = X(-s) + backLength * scale * Math.cos(angle2);
                    const endY2 = Y(h) + backLength * scale * Math.sin(angle2);
                    // Convex: refracted through F
                    // Refracted ray (forward)
                    ctx.strokeStyle = "#ff9900"
                    ctx.beginPath();
                    ctx.moveTo(X(0), Y(h));
                    ctx.lineTo(endX, endY);
                    ctx.stroke();

                    // Refracted ray (forward)
                    ctx.strokeStyle = "#ff9900"
                    ctx.beginPath();
                    ctx.moveTo(X(0), Y(h*R/(R-s)));
                    ctx.lineTo(endX2, endY2);
                    ctx.stroke();
                } else if (s<R && s>f) {
                    const backLength = 1.5;
                    const angle = Math.atan2(centerY - Y(h), X(-f) - X(0));
                    const angle2 = Math.atan2(centerY - Y(h), X(s) - X(R));
                    const endX = X(0) + backLength * scale * Math.cos(angle);
                    const endY = Y(h) + backLength * scale * Math.sin(angle);
                    const endX2 = X(-s) + backLength * scale * Math.cos(angle2);
                    const endY2 = Y(h) + backLength * scale * Math.sin(angle2);
                    // Convex: refracted through F
                    // Refracted ray (forward)
                    ctx.strokeStyle = "#ff9900"
                    ctx.beginPath();
                    ctx.moveTo(X(0), Y(h));
                    ctx.lineTo(endX, endY);
                    ctx.stroke();

                    // Refracted ray (forward)
                    ctx.strokeStyle = "#ff9900"
                    ctx.beginPath();
                    ctx.moveTo(X(0), Y(h*R/(R-s)));
                    ctx.lineTo(endX2, endY2);
                    ctx.stroke();
                
                } else if (s < f) {
                    // Concave: diverge, but extend backward to F'
                    const backLength = 1.5;
                    const angle = Math.atan2(centerY - Y(h), X(-f) - X(0));
                    const angle2 = Math.atan2(centerY - Y(h), X(s) - X(R));
                    const endX = X(0) + backLength * scale * Math.cos(angle);
                    const endY = Y(h) + backLength * scale * Math.sin(angle);
                    const endX2 = X(-s) + backLength * scale * Math.cos(angle2);
                    const endY2 = Y(h) + backLength * scale * Math.sin(angle2);

                    // Refracted ray (forward)
                    ctx.strokeStyle = "#ff9900"
                    ctx.beginPath();
                    ctx.moveTo(X(0), Y(h));
                    ctx.lineTo(endX, endY);
                    ctx.stroke();

                    // Dashed extension backward to F'
                    ctx.strokeStyle = "#ff9900"
                    ctx.setLineDash([4, 3]);
                    ctx.beginPath();
                    ctx.moveTo(X(0), Y(h));
                    ctx.lineTo(X(-s_prime), Y(h_prime));
                    ctx.stroke();
                    ctx.setLineDash([]);

                    // === Ray 2: Through center ===
                    ctx.strokeStyle = "#ff9900";
                    ctx.setLineDash([4, 3]);
                    ctx.beginPath();
                    ctx.moveTo(X(-s), Y(h));
                    ctx.lineTo(X(-s_prime), Y(h_prime));
                    ctx.stroke();
                    ctx.setLineDash([]);

                    // Refracted ray (forward)
                    ctx.strokeStyle = "#ff9900"
                    ctx.beginPath();
                    ctx.moveTo(X(0), Y(h*R/(R-s)));
                    ctx.lineTo(endX2, endY2);
                    ctx.stroke();
                }
            } else if (s>0 && f<0) {
                    const backLength = 1.5;
                    const angle = Math.atan2(Y(h) - centerY, X(f) - X(0));
                    const angle2 = Math.atan2(Y(h) - centerY, X(R) - X(s));
                    const endX = X(0) + backLength * scale * Math.cos(angle);
                    const endY = Y(h) + backLength * scale * Math.sin(angle);
                    const endX2 = X(-s) + backLength * scale * Math.cos(angle2);
                    const endY2 = Y(h) + backLength * scale * Math.sin(angle2);
                    // Convex: refracted through F
                    ctx.strokeStyle = "#ff9900"
                    ctx.setLineDash([4, 3]);
                    ctx.beginPath();
                    ctx.moveTo(X(0), Y(h));
                    ctx.lineTo(X(-s_prime), Y(h_prime));
                    ctx.stroke();
                    ctx.setLineDash([]);

                    ctx.strokeStyle = "#ff9900"
                    ctx.beginPath();
                    ctx.moveTo(X(0), Y(h));
                    ctx.lineTo(endX, endY);
                    ctx.stroke();


                    // === Ray 2: Through center ===
                    ctx.strokeStyle = "#ff9900";
                    ctx.setLineDash([4, 3]);
                    ctx.beginPath();
                    ctx.moveTo(X(0), Y(h*R/(R-s)));
                    ctx.lineTo(X(-s_prime), Y(h_prime));
                    ctx.stroke();
                    ctx.setLineDash([]);

                    ctx.strokeStyle = "#ff9900"
                    ctx.beginPath();
                    ctx.moveTo(X(0), Y(h*R/(R-s)));
                    ctx.lineTo(endX2, endY2);
                    ctx.stroke();
            }
            // Draw legend
            ctx.fillStyle = "#333";
            ctx.font = "14px sans-serif";
            ctx.fillText("üî¥ Object", 10, 20);
            ctx.fillText("üü¢ Image", 10, 40);
            ctx.fillText("üîµ Mirror Axis", 10, 60);
            ctx.fillText("üü° Ray", 10, 80);
        }
    
        // Initialize MathJax rendering
        window.addEventListener('load', function() {
            MathJax.typesetPromise();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'969dc933e67826cd',t:'MTc1NDMwNzY5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
